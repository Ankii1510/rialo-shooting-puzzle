import React, { useEffect, useRef, useState } from "react";

/*
Simple ‚Äî original-style Rialo Shooting Puzzle
Centered, readable, dark theme, banner, targets, score & lives.
*/

const STATIC_QUESTIONS = [
  { q: "What can you do on Rialo?", correct: "Earn", wrong: ["Cook", "Chat"] },
  { q: "Rialo is primarily focused on?", correct: "On-chain finance", wrong: ["Social media", "Streaming"] },
  { q: "Which feature commonly appears in DeFi platforms?", correct: "Liquidity", wrong: ["Baking", "Messaging"] },
  { q: "Which action helps you grow funds?", correct: "Stake", wrong: ["Swipe", "Post"] },
  { q: "A common DeFi component is?", correct: "Yield", wrong: ["Stories", "Profiles"] },
];

function randBetween(a,b){ return a + Math.random()*(b-a); }

export default function RialoShootingPuzzle() {
  const [questions] = useState(STATIC_QUESTIONS);
  const [round, setRound] = useState(0);
  const [score, setScore] = useState(0);
  const [lives, setLives] = useState(3);
  const [targets, setTargets] = useState([]);
  const containerRef = useRef(null);
  const idRef = useRef(1);

  useEffect(() => {
    spawnTargets(round);
    // eslint-disable-next-line
  }, [round]);

  function spawnTargets(index){
    const q = questions[index];
    if(!q) return;
    const rect = containerRef.current?.getBoundingClientRect() || { width: 800, height: 300 };
    const answers = [q.correct, ...q.wrong].sort(()=>0.5-Math.random());
    const newT = [];
    for(let i=0;i<6;i++){
      newT.push({
        id: idRef.current++,
        text: answers[i % answers.length],
        x: randBetween(40, rect.width-140),
        y: randBetween(40, rect.height-90)
      });
    }
    setTargets(newT);
  }

  function shoot(id){
    const t = targets.find(x=>x.id===id);
    if(!t) return;
    const q = questions[round];
    if(t.text === q.correct){
      setScore(s=>s+10);
      if(round+1 < questions.length) setRound(r=>r+1);
      else alert("üéâ You finished! Score: "+(score+10));
    } else {
      setLives(l=>l-1);
      if(lives-1 <= 0){
        alert("Game Over ‚Äî Score: "+score);
        // reset
        setScore(0); setLives(3); setRound(0);
      }
    }
    setTargets(prev=>prev.filter(x=>x.id!==id));
  }

  return (
    <div className="min-h-screen flex items-center justify-center" style={{ background: "linear-gradient(135deg,#0f0c29,#302b63)", color:'#e6f7ff' }}>
      <div style={{ width: '980px', maxWidth:'96%', padding:20, borderRadius:12, background:'rgba(255,255,255,0.03)', boxShadow:'0 10px 30px rgba(0,0,0,0.6)' }}>
        <div style={{ textAlign:'center', marginBottom:12 }}>
          <h1 style={{ margin:0, fontSize:28, fontWeight:800, background:'linear-gradient(90deg,#7ee7ff,#b28bff)', WebkitBackgroundClip:'text', color:'transparent' }}>
            üî• RIALO SHOOTING PUZZLE
          </h1>
          <div style={{ marginTop:6, color:'#cfeef9' }}>Shoot the correct answer to progress</div>
        </div>

        <div style={{ display:'flex', gap:16 }}>
          {/* Game area */}
          <div ref={containerRef} style={{ flex:1, height:320, position:'relative', borderRadius:10, background:'rgba(0,0,0,0.25)', border:'1px solid rgba(255,255,255,0.04)', overflow:'hidden' }}>
            {targets.map(t=>(
              <div key={t.id}
                   onClick={()=>shoot(t.id)}
                   style={{
                     position:'absolute',
                     left:t.x,
                     top:t.y,
                     padding:'8px 12px',
                     background:'linear-gradient(90deg, rgba(126,231,255,0.06), rgba(124,58,237,0.06))',
                     border:'1px solid rgba(126,231,255,0.12)',
                     borderRadius:10,
                     color:'#eafcff',
                     cursor:'pointer',
                     userSelect:'none'
                   }}>
                {t.text}
              </div>
            ))}
          </div>

          {/* Sidebar */}
          <div style={{ width:260 }}>
            <div style={{ padding:12, background:'rgba(255,255,255,0.02)', borderRadius:8 }}>
              <div style={{ fontSize:12, color:'#aee6ff' }}>Question</div>
              <div style={{ marginTop:8, fontWeight:700 }}>{questions[round]?.q}</div>

              <div style={{ marginTop:12 }}>
                <div style={{ fontSize:12, color:'#aee6ff' }}>Score</div>
                <div style={{ fontWeight:800, fontSize:18 }}>{score}</div>
              </div>

              <div style={{ marginTop:12 }}>
                <div style={{ fontSize:12, color:'#aee6ff' }}>Lives</div>
                <div style={{ fontWeight:700, fontSize:16 }}>‚ù§Ô∏è {lives}</div>
              </div>

              <button onClick={() => { setScore(0); setLives(3); setRound(0); spawnTargets(0); }} style={{ marginTop:14, width:'100%', padding:10, borderRadius:8, background:'#2563eb', color:'#fff', border:'none', cursor:'pointer' }}>
                Restart
              </button>
            </div>
          </div>
        </div>

        <div style={{ marginTop:12, fontSize:12, color:'#9ee7ff' }}>Made with ‚ù§Ô∏è ‚Äî Rialo style</div>
      </div>
    </div>
  );
}



